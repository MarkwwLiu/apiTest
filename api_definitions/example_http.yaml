# Example: HTTP API test definition
# 放入你的 API 定義，框架會自動產生 pytest 測試案例

name: "Example HTTP API"
base_url: "${API_BASE_URL:-https://jsonplaceholder.typicode.com}"

default_headers:
  Content-Type: "application/json"
  Accept: "application/json"

# (可選) Authentication
# auth:
#   type: "bearer"
#   token: "${API_TOKEN}"

# (可選) 全域 Retry 設定
retry:
  max_retries: 2
  backoff: [1, 2, 4]
  retry_on_status: [500, 502, 503]
  retry_on_timeout: true

# 引用 test_data/ 下的測試資料 (解耦合)
test_data_file: "example_posts.yaml"

http_endpoints:
  - name: "list_posts"
    url: "/posts"
    method: "GET"
    expected_status: 200
    timeout: 10
    tags: ["list_posts", "read", "posts"]

  - name: "get_single_post"
    url: "/posts/1"
    method: "GET"
    expected_status: 200
    timeout: 10
    expected_body:
      id: 1
      userId: 1
      title: "type:string"     # 進階驗證: 型別檢查
      body: "exists:true"      # 進階驗證: 欄位存在檢查
    tags: ["get_single_post", "read", "posts"]

  - name: "create_post"
    url: "/posts"
    method: "POST"
    expected_status: 201
    max_response_time: 5000    # 回應時間不超過 5 秒
    timeout: 15
    body:
      title: "default title"
      body: "default body"
      userId: 1
    tags: ["create_post", "write", "posts"]

  - name: "update_post"
    url: "/posts/1"
    method: "PUT"
    expected_status: 200
    timeout: 15
    body:
      id: 1
      title: "updated title"
      body: "updated body"
      userId: 1
    tags: ["update_post", "write", "posts"]

  - name: "delete_post"
    url: "/posts/1"
    method: "DELETE"
    expected_status: 200
    timeout: 10
    tags: ["delete_post", "write", "posts"]

  - name: "get_comments_by_post"
    url: "/comments"
    method: "GET"
    query_params:
      postId: 1
    expected_status: 200
    timeout: 10
    expected_headers:
      content-type: "regex:application/json"   # 進階驗證: Header regex
    tags: ["get_comments_by_post", "read", "comments"]
